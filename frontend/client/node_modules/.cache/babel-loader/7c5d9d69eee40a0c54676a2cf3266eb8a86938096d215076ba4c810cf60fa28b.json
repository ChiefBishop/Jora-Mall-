{"ast":null,"code":"import _objectSpread from\"C:/Users/HP/OneDrive/Desktop/SUCCESSFUL PROJECTS/Jora mall/frontend/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'./AuthContext';// Import useAuth to get user, token, cart, showCustomModal, clearCart, fetchWalletBalance\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function CheckoutPage(){const{user,token,cart,clearCart,showCustomModal,fetchWalletBalance}=useAuth();// Get necessary context values\nconst navigate=useNavigate();// Hook for navigation\n// State for delivery address form\nconst[deliveryInfo,setDeliveryInfo]=useState({fullName:(user===null||user===void 0?void 0:user.username)||'',// Pre-fill with username if available (using optional chaining)\nemail:(user===null||user===void 0?void 0:user.email)||'',// Pre-fill with email if available\naddress:'',city:'',postalCode:'',country:''});const[paymentMethod,setPaymentMethod]=useState('paystack');// Default payment method\nconst[loading,setLoading]=useState(false);// State for loading indicator during checkout process\nconst[error,setError]=useState(null);// State for displaying error messages\n// --- IMPORTANT: This URL is for your DEPLOYED backend ---\n// If you redeploy your backend and its URL changes, you MUST update it here.\nconst backendBaseUrl='https://jora-mall-backend.onrender.com';// Function to format price as Naira\nconst formatPrice=price=>{return new Intl.NumberFormat('en-NG',{style:'currency',currency:'NGN'}).format(price);};// Effect to handle initial checks: cart empty or user not logged in\nuseEffect(()=>{// Stringify cart.items to ensure effect only re-runs if cart content changes, not just reference\nif(!cart||!cart.items||cart.items.length===0){showCustomModal('Your cart is empty. Please add items before checking out.',()=>{navigate('/cart');// Redirect to cart page\n});return;// Exit early\n}// Also handle case where user somehow lands here without being logged in (though ProtectedRoute should catch this)\nif(!user||!token){showCustomModal('You must be logged in to proceed to checkout.',()=>{navigate('/login');// Redirect to login page\n});return;// Exit early\n}// Fetch wallet balance when component mounts or user/token changes\nfetchWalletBalance(token);},[JSON.stringify(cart.items),user,token,navigate,showCustomModal,fetchWalletBalance]);// Dependencies include stringified cart items for content change detection\n// Handle input changes for delivery information form\nconst handleDeliveryInfoChange=e=>{const{name,value}=e.target;setDeliveryInfo(prevInfo=>_objectSpread(_objectSpread({},prevInfo),{},{[name]:value}));};// Function to initiate Paystack payment by calling your backend\nconst initiatePaystackPayment=async(orderId,amount,customerEmail)=>{setLoading(true);// Set loading state while payment initiation is in progress\nsetError(null);// Clear any previous errors\ntry{// Step 1: Call your backend API to initialize the Paystack transaction\nconst response=await fetch(\"\".concat(backendBaseUrl,\"/api/paystack/initialize\"),{// Using deployed backend URL\nmethod:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)// Authenticate the request with JWT token\n},body:JSON.stringify({amount:amount*100,// Paystack expects amount in kobo (Nigerian cents), so multiply by 100\nemail:customerEmail,orderId:orderId// Pass the internal order ID created on your backend\n})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.message||'Failed to initialize Paystack transaction.');}const{authorizationUrl}=await response.json();// Get the authorization URL from Paystack\nconsole.log('Paystack authorization URL:',authorizationUrl);// Step 2: Redirect the user's browser to the Paystack payment page\nwindow.location.href=authorizationUrl;// Note: No `setLoading(false)` here, as the page will immediately redirect.\n// The rest of the success flow (e.g., clearing cart, showing confirmation)\n// happens on the `OrderConfirmationPage` after Paystack redirects back.\n}catch(err){console.error('Error initiating Paystack payment:',err);setError(err.message);// Set error message\nshowCustomModal(\"Paystack payment initiation failed: \".concat(err.message));// Show error to user\nsetLoading(false);// Reset loading state if an error prevents redirection\n}};// Main handler for the checkout submission\nconst handleCheckout=async e=>{e.preventDefault();// Prevent default form submission\nsetLoading(true);// Set loading state\nsetError(null);// Clear previous errors\n// --- Frontend Validation ---\nif(!deliveryInfo.fullName||!deliveryInfo.address||!deliveryInfo.city||!deliveryInfo.postalCode||!deliveryInfo.country){showCustomModal('Please fill in all delivery information fields.');setLoading(false);return;}if(!user||!token){showCustomModal('You must be logged in to complete checkout. Please log in or register.',()=>{navigate('/login');});setLoading(false);return;}if(!cart||!cart.items||cart.items.length===0){showCustomModal('Your cart is empty. Please add items before checking out.',()=>{navigate('/cart');});setLoading(false);return;}// NEW: Wallet payment specific validation\nif(paymentMethod==='wallet'&&(!user.walletBalance||user.walletBalance<cart.totalAmount)){showCustomModal('Insufficient wallet balance. Please add funds or choose another payment method.');setLoading(false);return;}// --- End Frontend Validation ---\ntry{// Step 1: Create the order on your backend API\nconst orderResponse=await fetch(\"\".concat(backendBaseUrl,\"/api/orders\"),{// Using deployed backend URL\nmethod:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)// Authenticate the request\n},body:JSON.stringify({items:cart.items.map(item=>({// Ensure product ID is used, whether from `product._id` or `product` directly (for local cart items)\nproduct:item.product._id||item.product,quantity:item.quantity,price:item.price,name:item.name,imageUrl:item.imageUrl})),totalAmount:cart.totalAmount,shippingAddress:deliveryInfo,paymentMethod:paymentMethod// Pass the selected payment method to the backend\n})});if(!orderResponse.ok){const errorData=await orderResponse.json();throw new Error(errorData.message||'Failed to create order on backend.');}const orderData=await orderResponse.json();console.log('Order created successfully on backend:',orderData);// Step 2: Handle payment based on selected method\nif(paymentMethod==='paystack'){await initiatePaystackPayment(orderData.order._id,orderData.order.totalAmount,user.email);}else if(paymentMethod==='wallet'){// If payment was handled by wallet on backend, navigate to confirmation page directly\n// Backend already deducted funds and updated order status\nshowCustomModal('Payment successful via wallet!',()=>{clearCart();// Clear cart after successful wallet payment\nfetchWalletBalance(token);// Refresh wallet balance after deduction\nnavigate('/order-confirmation',{state:{orderId:orderData.order._id}});// Pass order ID for confirmation page\n},3000);// Auto-dismiss after 3 seconds\n}// IMPORTANT: The page will redirect to Paystack if paymentMethod is 'paystack'.\n// If paymentMethod is 'wallet', the modal and navigation above handle it.\n// Do NOT clear cart or navigate here for Paystack path. That's handled by Paystack verification\n// on the OrderConfirmationPage once the payment is confirmed.\n}catch(err){console.error('Error during checkout process:',err);setError(err.message);// Set form error\nshowCustomModal(\"Checkout failed: \".concat(err.message));// Show modal error\nsetLoading(false);// Reset loading state if the process fails before redirection\n}};// Render a loading/redirect message if cart is empty, user is not logged in, or during initial checks.\n// This prevents the flickering by providing a stable UI during transient states.\nif(!cart||!cart.items||cart.items.length===0||!user||!token){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white text-gray-800 p-8 rounded-xl shadow-lg text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold mb-4\",children:\"Redirecting or checking cart status...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500 mx-auto mt-4\"})]})});}// Main render for the Checkout Page\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-[#000080] p-4 sm:p-8 text-white\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"text-center py-8 bg-gradient-to-r from-blue-800 to-indigo-900 rounded-b-xl shadow-lg mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold text-white tracking-tight\",children:\"Checkout\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-blue-200 mt-2\",children:\"Complete your purchase\"})]}),/*#__PURE__*/_jsx(\"main\",{className:\"container mx-auto px-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl shadow-lg p-6 md:p-8 text-gray-800\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-6 text-center text-blue-700\",children:\"Delivery Information & Payment\"}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative mb-4\",role:\"alert\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"font-bold\",children:\"Error!\"}),/*#__PURE__*/_jsx(\"span\",{className:\"block sm:inline ml-2\",children:error})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-4 text-gray-800\",children:\"Order Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"border border-gray-200 rounded-lg p-4 space-y-3 bg-gray-50\",children:[cart.items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center text-sm\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-700\",children:[item.name,\" (x\",item.quantity,\")\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-900\",children:formatPrice(item.price*item.quantity)})]},item.product._id||item.product)),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-gray-200 pt-3 mt-3 flex justify-between items-center font-bold text-lg\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total:\"}),/*#__PURE__*/_jsx(\"span\",{children:formatPrice(cart.totalAmount)})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-4 text-gray-800\",children:\"Delivery Details\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCheckout,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"fullName\",className:\"block text-sm font-medium text-gray-700\",children:\"Full Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"fullName\",name:\"fullName\",value:deliveryInfo.fullName,onChange:handleDeliveryInfoChange,className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",className:\"block text-sm font-medium text-gray-700\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",name:\"email\",value:deliveryInfo.email,onChange:handleDeliveryInfoChange,className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",required:true,readOnly:!!user&&!!user.email// Make email read-only if user is logged in and has an email\n})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"address\",className:\"block text-sm font-medium text-gray-700\",children:\"Address\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"address\",name:\"address\",value:deliveryInfo.address,onChange:handleDeliveryInfoChange,className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"city\",className:\"block text-sm font-medium text-gray-700\",children:\"City\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"city\",name:\"city\",value:deliveryInfo.city,onChange:handleDeliveryInfoChange,className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"postalCode\",className:\"block text-sm font-medium text-gray-700\",children:\"Postal Code\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"postalCode\",name:\"postalCode\",value:deliveryInfo.postalCode,onChange:handleDeliveryInfoChange,className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"country\",className:\"block text-sm font-medium text-gray-700\",children:\"Country\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"country\",name:\"country\",value:deliveryInfo.country,onChange:handleDeliveryInfoChange,className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-3 text-gray-800\",children:\"Select Payment Method\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",id:\"paystack\",name:\"paymentMethod\",value:\"paystack\",checked:paymentMethod==='paystack',onChange:()=>setPaymentMethod('paystack'),className:\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"paystack\",className:\"ml-3 block text-base font-medium text-gray-700\",children:\"Pay with Card / Bank Transfer (via Paystack)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",id:\"wallet\",name:\"paymentMethod\",value:\"wallet\",checked:paymentMethod==='wallet',onChange:()=>setPaymentMethod('wallet'),className:\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\"// Disable wallet option if user is not logged in or has insufficient balance\n,disabled:!user||(user.walletBalance||0)<cart.totalAmount}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"wallet\",className:\"ml-3 block text-base font-medium text-gray-700\",children:[\"Pay with Wallet (Balance: \",formatPrice((user===null||user===void 0?void 0:user.walletBalance)||0),\")\",(!user||(user.walletBalance||0)<cart.totalAmount)&&/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-red-500 ml-2\",children:\"(Insufficient funds or not logged in)\"})]})]})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300 shadow-md flex items-center justify-center\"// Disable button if loading, cart empty, or user not logged in\n,disabled:loading||!cart.items.length||!user,children:loading?/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}):\"Complete Order with \".concat(paymentMethod==='wallet'?'Wallet':'Paystack')})]})]})]})]})}),/*#__PURE__*/_jsx(\"footer\",{className:\"text-center py-6 mt-8 text-blue-200 text-sm\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"\\xA9 \",new Date().getFullYear(),\" Jora Mall. All rights reserved.\"]})})]});}export default CheckoutPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useAuth","jsx","_jsx","jsxs","_jsxs","CheckoutPage","user","token","cart","clearCart","showCustomModal","fetchWalletBalance","navigate","deliveryInfo","setDeliveryInfo","fullName","username","email","address","city","postalCode","country","paymentMethod","setPaymentMethod","loading","setLoading","error","setError","backendBaseUrl","formatPrice","price","Intl","NumberFormat","style","currency","format","items","length","JSON","stringify","handleDeliveryInfoChange","e","name","value","target","prevInfo","_objectSpread","initiatePaystackPayment","orderId","amount","customerEmail","response","fetch","concat","method","headers","body","ok","errorData","json","Error","message","authorizationUrl","console","log","window","location","href","err","handleCheckout","preventDefault","walletBalance","totalAmount","orderResponse","map","item","product","_id","quantity","imageUrl","shippingAddress","orderData","order","state","className","children","role","onSubmit","htmlFor","type","id","onChange","required","readOnly","checked","disabled","xmlns","fill","viewBox","cx","cy","r","stroke","strokeWidth","d","Date","getFullYear"],"sources":["C:/Users/HP/OneDrive/Desktop/SUCCESSFUL PROJECTS/Jora mall/frontend/client/src/CheckoutPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from './AuthContext'; // Import useAuth to get user, token, cart, showCustomModal, clearCart, fetchWalletBalance\r\n\r\nfunction CheckoutPage() {\r\n  const { user, token, cart, clearCart, showCustomModal, fetchWalletBalance } = useAuth(); // Get necessary context values\r\n  const navigate = useNavigate(); // Hook for navigation\r\n\r\n  // State for delivery address form\r\n  const [deliveryInfo, setDeliveryInfo] = useState({\r\n    fullName: user?.username || '', // Pre-fill with username if available (using optional chaining)\r\n    email: user?.email || '',       // Pre-fill with email if available\r\n    address: '',\r\n    city: '',\r\n    postalCode: '',\r\n    country: '',\r\n  });\r\n\r\n  const [paymentMethod, setPaymentMethod] = useState('paystack'); // Default payment method\r\n  const [loading, setLoading] = useState(false); // State for loading indicator during checkout process\r\n  const [error, setError] = useState(null);     // State for displaying error messages\r\n\r\n  // --- IMPORTANT: This URL is for your DEPLOYED backend ---\r\n  // If you redeploy your backend and its URL changes, you MUST update it here.\r\n  const backendBaseUrl = 'https://jora-mall-backend.onrender.com';\r\n\r\n  // Function to format price as Naira\r\n  const formatPrice = (price) => {\r\n    return new Intl.NumberFormat('en-NG', { style: 'currency', currency: 'NGN' }).format(price);\r\n  };\r\n\r\n  // Effect to handle initial checks: cart empty or user not logged in\r\n  useEffect(() => {\r\n    // Stringify cart.items to ensure effect only re-runs if cart content changes, not just reference\r\n    if (!cart || !cart.items || cart.items.length === 0) {\r\n      showCustomModal('Your cart is empty. Please add items before checking out.', () => {\r\n        navigate('/cart'); // Redirect to cart page\r\n      });\r\n      return; // Exit early\r\n    }\r\n    // Also handle case where user somehow lands here without being logged in (though ProtectedRoute should catch this)\r\n    if (!user || !token) {\r\n      showCustomModal('You must be logged in to proceed to checkout.', () => {\r\n        navigate('/login'); // Redirect to login page\r\n      });\r\n      return; // Exit early\r\n    }\r\n    // Fetch wallet balance when component mounts or user/token changes\r\n    fetchWalletBalance(token);\r\n  }, [JSON.stringify(cart.items), user, token, navigate, showCustomModal, fetchWalletBalance]); // Dependencies include stringified cart items for content change detection\r\n\r\n\r\n  // Handle input changes for delivery information form\r\n  const handleDeliveryInfoChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setDeliveryInfo(prevInfo => ({\r\n      ...prevInfo,\r\n      [name]: value,\r\n    }));\r\n  };\r\n\r\n  // Function to initiate Paystack payment by calling your backend\r\n  const initiatePaystackPayment = async (orderId, amount, customerEmail) => {\r\n    setLoading(true); // Set loading state while payment initiation is in progress\r\n    setError(null);   // Clear any previous errors\r\n\r\n    try {\r\n      // Step 1: Call your backend API to initialize the Paystack transaction\r\n      const response = await fetch(`${backendBaseUrl}/api/paystack/initialize`, { // Using deployed backend URL\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${token}`, // Authenticate the request with JWT token\r\n        },\r\n        body: JSON.stringify({\r\n          amount: amount * 100, // Paystack expects amount in kobo (Nigerian cents), so multiply by 100\r\n          email: customerEmail,\r\n          orderId: orderId, // Pass the internal order ID created on your backend\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.message || 'Failed to initialize Paystack transaction.');\r\n      }\r\n\r\n      const { authorizationUrl } = await response.json(); // Get the authorization URL from Paystack\r\n      console.log('Paystack authorization URL:', authorizationUrl);\r\n\r\n      // Step 2: Redirect the user's browser to the Paystack payment page\r\n      window.location.href = authorizationUrl;\r\n\r\n      // Note: No `setLoading(false)` here, as the page will immediately redirect.\r\n      // The rest of the success flow (e.g., clearing cart, showing confirmation)\r\n      // happens on the `OrderConfirmationPage` after Paystack redirects back.\r\n\r\n    } catch (err) {\r\n      console.error('Error initiating Paystack payment:', err);\r\n      setError(err.message); // Set error message\r\n      showCustomModal(`Paystack payment initiation failed: ${err.message}`); // Show error to user\r\n      setLoading(false); // Reset loading state if an error prevents redirection\r\n    }\r\n  };\r\n\r\n\r\n  // Main handler for the checkout submission\r\n  const handleCheckout = async (e) => {\r\n    e.preventDefault(); // Prevent default form submission\r\n    setLoading(true);   // Set loading state\r\n    setError(null);     // Clear previous errors\r\n\r\n    // --- Frontend Validation ---\r\n    if (!deliveryInfo.fullName || !deliveryInfo.address || !deliveryInfo.city || !deliveryInfo.postalCode || !deliveryInfo.country) {\r\n      showCustomModal('Please fill in all delivery information fields.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (!user || !token) {\r\n      showCustomModal('You must be logged in to complete checkout. Please log in or register.', () => {\r\n        navigate('/login');\r\n      });\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (!cart || !cart.items || cart.items.length === 0) {\r\n      showCustomModal('Your cart is empty. Please add items before checking out.', () => {\r\n        navigate('/cart');\r\n      });\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // NEW: Wallet payment specific validation\r\n    if (paymentMethod === 'wallet' && (!user.walletBalance || user.walletBalance < cart.totalAmount)) {\r\n      showCustomModal('Insufficient wallet balance. Please add funds or choose another payment method.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    // --- End Frontend Validation ---\r\n\r\n    try {\r\n      // Step 1: Create the order on your backend API\r\n      const orderResponse = await fetch(`${backendBaseUrl}/api/orders`, { // Using deployed backend URL\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${token}`, // Authenticate the request\r\n        },\r\n        body: JSON.stringify({\r\n          items: cart.items.map(item => ({\r\n            // Ensure product ID is used, whether from `product._id` or `product` directly (for local cart items)\r\n            product: item.product._id || item.product,\r\n            quantity: item.quantity,\r\n            price: item.price,\r\n            name: item.name,\r\n            imageUrl: item.imageUrl\r\n          })),\r\n          totalAmount: cart.totalAmount,\r\n          shippingAddress: deliveryInfo,\r\n          paymentMethod: paymentMethod, // Pass the selected payment method to the backend\r\n        }),\r\n      });\r\n\r\n      if (!orderResponse.ok) {\r\n        const errorData = await orderResponse.json();\r\n        throw new Error(errorData.message || 'Failed to create order on backend.');\r\n      }\r\n\r\n      const orderData = await orderResponse.json();\r\n      console.log('Order created successfully on backend:', orderData);\r\n\r\n      // Step 2: Handle payment based on selected method\r\n      if (paymentMethod === 'paystack') {\r\n        await initiatePaystackPayment(orderData.order._id, orderData.order.totalAmount, user.email);\r\n      } else if (paymentMethod === 'wallet') {\r\n        // If payment was handled by wallet on backend, navigate to confirmation page directly\r\n        // Backend already deducted funds and updated order status\r\n        showCustomModal('Payment successful via wallet!', () => {\r\n          clearCart(); // Clear cart after successful wallet payment\r\n          fetchWalletBalance(token); // Refresh wallet balance after deduction\r\n          navigate('/order-confirmation', { state: { orderId: orderData.order._id } }); // Pass order ID for confirmation page\r\n        }, 3000); // Auto-dismiss after 3 seconds\r\n      }\r\n\r\n      // IMPORTANT: The page will redirect to Paystack if paymentMethod is 'paystack'.\r\n      // If paymentMethod is 'wallet', the modal and navigation above handle it.\r\n      // Do NOT clear cart or navigate here for Paystack path. That's handled by Paystack verification\r\n      // on the OrderConfirmationPage once the payment is confirmed.\r\n\r\n    } catch (err) {\r\n      console.error('Error during checkout process:', err);\r\n      setError(err.message); // Set form error\r\n      showCustomModal(`Checkout failed: ${err.message}`); // Show modal error\r\n      setLoading(false); // Reset loading state if the process fails before redirection\r\n    }\r\n  };\r\n\r\n  // Render a loading/redirect message if cart is empty, user is not logged in, or during initial checks.\r\n  // This prevents the flickering by providing a stable UI during transient states.\r\n  if (!cart || !cart.items || cart.items.length === 0 || !user || !token) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\">\r\n        <div className=\"bg-white text-gray-800 p-8 rounded-xl shadow-lg text-center\">\r\n          <p className=\"text-2xl font-semibold mb-4\">Redirecting or checking cart status...</p>\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500 mx-auto mt-4\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Main render for the Checkout Page\r\n  return (\r\n    <div className=\"min-h-screen bg-[#000080] p-4 sm:p-8 text-white\">\r\n      <header className=\"text-center py-8 bg-gradient-to-r from-blue-800 to-indigo-900 rounded-b-xl shadow-lg mb-8\">\r\n        <h1 className=\"text-4xl font-bold text-white tracking-tight\">Checkout</h1>\r\n        <p className=\"text-xl text-blue-200 mt-2\">Complete your purchase</p>\r\n      </header>\r\n\r\n      <main className=\"container mx-auto px-4\">\r\n        <div className=\"bg-white rounded-xl shadow-lg p-6 md:p-8 text-gray-800\">\r\n          <h2 className=\"text-2xl font-bold mb-6 text-center text-blue-700\">Delivery Information & Payment</h2>\r\n\r\n          {error && (\r\n            <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative mb-4\" role=\"alert\">\r\n              <strong className=\"font-bold\">Error!</strong>\r\n              <span className=\"block sm:inline ml-2\">{error}</span>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n            {/* Order Summary Section */}\r\n            <div>\r\n              <h3 className=\"text-xl font-semibold mb-4 text-gray-800\">Order Summary</h3>\r\n              <div className=\"border border-gray-200 rounded-lg p-4 space-y-3 bg-gray-50\">\r\n                {cart.items.map(item => (\r\n                  <div key={item.product._id || item.product} className=\"flex justify-between items-center text-sm\">\r\n                    <span className=\"text-gray-700\">{item.name} (x{item.quantity})</span>\r\n                    <span className=\"font-medium text-gray-900\">{formatPrice(item.price * item.quantity)}</span>\r\n                  </div>\r\n                ))}\r\n                <div className=\"border-t border-gray-200 pt-3 mt-3 flex justify-between items-center font-bold text-lg\">\r\n                  <span>Total:</span>\r\n                  <span>{formatPrice(cart.totalAmount)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Delivery Information Form */}\r\n            <div>\r\n              <h3 className=\"text-xl font-semibold mb-4 text-gray-800\">Delivery Details</h3>\r\n              <form onSubmit={handleCheckout} className=\"space-y-4\">\r\n                <div>\r\n                  <label htmlFor=\"fullName\" className=\"block text-sm font-medium text-gray-700\">Full Name</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"fullName\"\r\n                    name=\"fullName\"\r\n                    value={deliveryInfo.fullName}\r\n                    onChange={handleDeliveryInfoChange}\r\n                    className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                  <input\r\n                    type=\"email\"\r\n                    id=\"email\"\r\n                    name=\"email\"\r\n                    value={deliveryInfo.email}\r\n                    onChange={handleDeliveryInfoChange}\r\n                    className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\r\n                    required\r\n                    readOnly={!!user && !!user.email} // Make email read-only if user is logged in and has an email\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"address\" className=\"block text-sm font-medium text-gray-700\">Address</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"address\"\r\n                    name=\"address\"\r\n                    value={deliveryInfo.address}\r\n                    onChange={handleDeliveryInfoChange}\r\n                    className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n                  <div>\r\n                    <label htmlFor=\"city\" className=\"block text-sm font-medium text-gray-700\">City</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      id=\"city\"\r\n                      name=\"city\"\r\n                      value={deliveryInfo.city}\r\n                      onChange={handleDeliveryInfoChange}\r\n                      className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\r\n                      required\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label htmlFor=\"postalCode\" className=\"block text-sm font-medium text-gray-700\">Postal Code</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      id=\"postalCode\"\r\n                      name=\"postalCode\"\r\n                      value={deliveryInfo.postalCode}\r\n                      onChange={handleDeliveryInfoChange}\r\n                      className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\r\n                      required\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label htmlFor=\"country\" className=\"block text-sm font-medium text-gray-700\">Country</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      id=\"country\"\r\n                      name=\"country\"\r\n                      value={deliveryInfo.country}\r\n                      onChange={handleDeliveryInfoChange}\r\n                      className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\r\n                      required\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* NEW: Payment Method Selection */}\r\n                <div className=\"mt-6\">\r\n                  <h3 className=\"text-xl font-semibold mb-3 text-gray-800\">Select Payment Method</h3>\r\n                  <div className=\"space-y-3\">\r\n                    {/* Paystack Option */}\r\n                    <div className=\"flex items-center\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        id=\"paystack\"\r\n                        name=\"paymentMethod\"\r\n                        value=\"paystack\"\r\n                        checked={paymentMethod === 'paystack'}\r\n                        onChange={() => setPaymentMethod('paystack')}\r\n                        className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\"\r\n                      />\r\n                      <label htmlFor=\"paystack\" className=\"ml-3 block text-base font-medium text-gray-700\">\r\n                        Pay with Card / Bank Transfer (via Paystack)\r\n                      </label>\r\n                    </div>\r\n\r\n                    {/* Wallet Option */}\r\n                    <div className=\"flex items-center\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        id=\"wallet\"\r\n                        name=\"paymentMethod\"\r\n                        value=\"wallet\"\r\n                        checked={paymentMethod === 'wallet'}\r\n                        onChange={() => setPaymentMethod('wallet')}\r\n                        className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300\"\r\n                        // Disable wallet option if user is not logged in or has insufficient balance\r\n                        disabled={!user || (user.walletBalance || 0) < cart.totalAmount}\r\n                      />\r\n                      <label htmlFor=\"wallet\" className=\"ml-3 block text-base font-medium text-gray-700\">\r\n                        Pay with Wallet (Balance: {formatPrice(user?.walletBalance || 0)})\r\n                        {(!user || (user.walletBalance || 0) < cart.totalAmount) && (\r\n                          <span className=\"text-sm text-red-500 ml-2\">\r\n                            (Insufficient funds or not logged in)\r\n                          </span>\r\n                        )}\r\n                      </label>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n\r\n                {/* Payment button */}\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300 shadow-md flex items-center justify-center\"\r\n                  // Disable button if loading, cart empty, or user not logged in\r\n                  disabled={loading || !cart.items.length || !user}\r\n                >\r\n                  {loading ? (\r\n                    <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                    </svg>\r\n                  ) : `Complete Order with ${paymentMethod === 'wallet' ? 'Wallet' : 'Paystack'}`}\r\n                </button>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n\r\n      <footer className=\"text-center py-6 mt-8 text-blue-200 text-sm\">\r\n        <p>&copy; {new Date().getFullYear()} Jora Mall. All rights reserved.</p>\r\n      </footer>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CheckoutPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
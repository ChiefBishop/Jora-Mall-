{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';// Added useRef\nimport{Link,useLocation,useNavigate}from'react-router-dom';import{useAuth}from'./AuthContext';// Import useAuth to access token, clearCart, showCustomModal\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function OrderConfirmationPage(){const{token,clearCart,showCustomModal}=useAuth();// Get token, clearCart, showCustomModal from context\nconst location=useLocation();// Hook to access URL's query parameters (where Paystack sends reference)\nconst navigate=useNavigate();// Hook for navigation\nconst[order,setOrder]=useState(null);// State to store fetched order details after verification\nconst[loading,setLoading]=useState(true);// State for loading indicator during verification\nconst[error,setError]=useState(null);// State for error messages\n// New ref to track if verification has already been attempted/completed\n// Using useRef to prevent re-renders when this value changes, and to persist across renders\nconst hasVerifiedPaymentRef=useRef(false);// Function to format price as Naira\nconst formatPrice=price=>{return new Intl.NumberFormat('en-NG',{style:'currency',currency:'NGN'}).format(price);};// useEffect to handle payment verification when the component mounts or token changes\nuseEffect(()=>{const queryParams=new URLSearchParams(location.search);const reference=queryParams.get('reference');// Get Paystack transaction reference from the URL query string\n// IMPORTANT: Check the ref to ensure verification only runs once per component mount\nif(hasVerifiedPaymentRef.current){console.log('OrderConfirmationPage: Verification already attempted, skipping.');setLoading(false);// Ensure loading is off if already verified\nreturn;// Exit the effect if already processed\n}// If no reference is found in the URL, it means the page was accessed incorrectly or payment wasn't initiated\nif(!reference){console.log('OrderConfirmationPage: No payment reference found in URL.');showCustomModal('No payment reference found. Your order could not be confirmed.',()=>{navigate('/cart');// Redirect to cart or home\n});setLoading(false);// Stop loading, as there's nothing to verify\nreturn;// Exit the effect\n}// Ensure a token exists before attempting to verify payment with the backend\nif(!token){console.log('OrderConfirmationPage: No token found, redirecting to login.');showCustomModal('You must be logged in to confirm your order.',()=>{navigate('/login');// Redirect to login if not authenticated\n});setLoading(false);return;// Exit function if no token\n}// Set the flag to true to prevent future re-runs of this effect for verification\nhasVerifiedPaymentRef.current=true;setLoading(true);// Explicitly set loading to true when starting verification\nsetError(null);// Clear any previous errors\n// Function to send the verification request to your backend\nconst verifyPayment=async()=>{console.log('OrderConfirmationPage: Initiating payment verification for reference:',reference);try{// Send a POST request to your backend's Paystack verification endpoint\nconst response=await fetch('https://jora-mall-backend.onrender.com/api/paystack/verify',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)// Authenticate the request with user's JWT token\n},body:JSON.stringify({reference})// Send the Paystack transaction reference\n});// Check if the backend response was successful\nif(!response.ok){const errorData=await response.json();throw new Error(errorData.message||'Payment verification failed on server.');}const data=await response.json();// Parse the successful response\nconsole.log('OrderConfirmationPage: Payment verification successful, response data:',data);// Check if the backend confirmed the order status\nif(data.order&&data.order.status==='completed'&&data.order.paymentStatus==='paid'){setOrder(data.order);// Set the confirmed order details in state\nclearCart();// Clear the user's cart in the frontend context\n// Use auto-dismiss modal for success confirmation\nshowCustomModal('Your order has been successfully placed!',()=>{// Optional: navigate to order history after acknowledging confirmation\n// navigate('/my-orders');\n},3000);// Auto-dismiss after 3 seconds\n}else{// If verification succeeded but order status is not as expected\nthrow new Error(data.message||'Order status not confirmed as completed. Please check your order history.');}}catch(err){console.error('OrderConfirmationPage: Error during payment verification:',err);setError(err.message);// Set error state\n// For errors, it's better to keep the modal with an OK button for user acknowledgement\nshowCustomModal(\"Order confirmation failed: \".concat(err.message),()=>{navigate('/my-orders');// Redirect to order history to allow user to check manually\n});}finally{setLoading(false);// Ensure loading state is turned off after fetch\n}};// Only trigger verification if all conditions are met\nverifyPayment();},[location.search,token,navigate,clearCart,showCustomModal]);// Dependencies for this effect\n// Render different UIs based on loading, error, or success states\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white text-gray-800 p-8 rounded-xl shadow-lg text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold mb-4\",children:\"Verifying your payment and confirming order...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500 mx-auto mt-4\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative m-4 text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:\"Error:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"block sm:inline ml-2\",children:error}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-4\",children:[\"Please check your \",/*#__PURE__*/_jsx(Link,{to:\"/my-orders\",className:\"text-blue-800 hover:underline\",children:\"Order History\"}),\" for updates or contact support.\"]})]})});}// If verification completed but no order data is set (e.g., failed silently or redirect issue)\nif(!order){// This case should ideally be caught by error handling or `!reference` check.\n// If it still happens, it indicates an unexpected state.\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white text-gray-800 p-8 rounded-xl shadow-lg text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold mb-4\",children:\"No order details found.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg mb-6\",children:\"Something went wrong or your order was not successfully processed.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"bg-blue-500 text-white py-3 px-8 rounded-lg font-medium hover:bg-blue-600 transition-colors duration-300 shadow-md\",children:\"Go to Home\"})]})});}// Render the confirmed order details\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-[#000080] p-4 sm:p-8 text-white\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"text-center py-8 bg-gradient-to-r from-blue-800 to-indigo-900 rounded-b-xl shadow-lg mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold text-white tracking-tight\",children:\"Order Confirmed!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-blue-200 mt-2\",children:\"Thank you for your purchase.\"})]}),/*#__PURE__*/_jsx(\"main\",{className:\"container mx-auto px-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl shadow-lg p-6 md:p-8 text-gray-800\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold mb-6 text-center text-green-700\",children:[\"Order #\",order._id]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-3\",children:\"Order Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 font-medium capitalize\",children:order.status})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Amount:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-blue-700\",children:formatPrice(order.totalAmount)})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Payment Status:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"capitalize\",children:order.paymentStatus})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Order Date:\"}),\" \",new Date(order.createdAt).toLocaleString()]}),order.paystackReference&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Paystack Ref:\"}),\" \",order.paystackReference]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-3\",children:\"Items Ordered\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:order.items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center border-b border-gray-100 pb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-700\",children:[item.name,\" (x\",item.quantity,\")\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-900\",children:formatPrice(item.price*item.quantity)})]},item.product))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-3\",children:\"Shipping Address\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-4 rounded-md space-y-1\",children:[/*#__PURE__*/_jsx(\"p\",{children:order.shippingAddress.fullName}),/*#__PURE__*/_jsx(\"p\",{children:order.shippingAddress.address}),/*#__PURE__*/_jsxs(\"p\",{children:[order.shippingAddress.city,\", \",order.shippingAddress.postalCode]}),/*#__PURE__*/_jsx(\"p\",{children:order.shippingAddress.country})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mt-8 space-y-4\",children:[/*#__PURE__*/_jsx(Link,{to:\"/my-orders\",className:\"bg-purple-600 text-white py-3 px-8 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-300 shadow-md block max-w-xs mx-auto\",children:\"View My Orders\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"text-blue-600 hover:underline block max-w-xs mx-auto\",children:\"Continue Shopping\"})]})]})}),/*#__PURE__*/_jsx(\"footer\",{className:\"text-center py-6 mt-8 text-blue-200 text-sm\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"\\xA9 \",new Date().getFullYear(),\" Jora Mall. All rights reserved.\"]})})]});}export default OrderConfirmationPage;","map":{"version":3,"names":["React","useEffect","useState","useRef","Link","useLocation","useNavigate","useAuth","jsx","_jsx","jsxs","_jsxs","OrderConfirmationPage","token","clearCart","showCustomModal","location","navigate","order","setOrder","loading","setLoading","error","setError","hasVerifiedPaymentRef","formatPrice","price","Intl","NumberFormat","style","currency","format","queryParams","URLSearchParams","search","reference","get","current","console","log","verifyPayment","response","fetch","method","headers","concat","body","JSON","stringify","ok","errorData","json","Error","message","data","status","paymentStatus","err","className","children","to","_id","totalAmount","Date","createdAt","toLocaleString","paystackReference","items","map","item","name","quantity","product","shippingAddress","fullName","address","city","postalCode","country","getFullYear"],"sources":["C:/Users/HP/OneDrive/Desktop/SUCCESSFUL PROJECTS/Jora mall/frontend/client/src/OrderConfirmationPage.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react'; // Added useRef\r\nimport { Link, useLocation, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from './AuthContext'; // Import useAuth to access token, clearCart, showCustomModal\r\n\r\nfunction OrderConfirmationPage() {\r\n  const { token, clearCart, showCustomModal } = useAuth(); // Get token, clearCart, showCustomModal from context\r\n  const location = useLocation(); // Hook to access URL's query parameters (where Paystack sends reference)\r\n  const navigate = useNavigate(); // Hook for navigation\r\n\r\n  const [order, setOrder] = useState(null);     // State to store fetched order details after verification\r\n  const [loading, setLoading] = useState(true); // State for loading indicator during verification\r\n  const [error, setError] = useState(null);     // State for error messages\r\n\r\n  // New ref to track if verification has already been attempted/completed\r\n  // Using useRef to prevent re-renders when this value changes, and to persist across renders\r\n  const hasVerifiedPaymentRef = useRef(false);\r\n\r\n  // Function to format price as Naira\r\n  const formatPrice = (price) => {\r\n    return new Intl.NumberFormat('en-NG', { style: 'currency', currency: 'NGN' }).format(price);\r\n  };\r\n\r\n  // useEffect to handle payment verification when the component mounts or token changes\r\n  useEffect(() => {\r\n    const queryParams = new URLSearchParams(location.search);\r\n    const reference = queryParams.get('reference'); // Get Paystack transaction reference from the URL query string\r\n\r\n    // IMPORTANT: Check the ref to ensure verification only runs once per component mount\r\n    if (hasVerifiedPaymentRef.current) {\r\n      console.log('OrderConfirmationPage: Verification already attempted, skipping.');\r\n      setLoading(false); // Ensure loading is off if already verified\r\n      return; // Exit the effect if already processed\r\n    }\r\n\r\n    // If no reference is found in the URL, it means the page was accessed incorrectly or payment wasn't initiated\r\n    if (!reference) {\r\n      console.log('OrderConfirmationPage: No payment reference found in URL.');\r\n      showCustomModal('No payment reference found. Your order could not be confirmed.', () => {\r\n        navigate('/cart'); // Redirect to cart or home\r\n      });\r\n      setLoading(false); // Stop loading, as there's nothing to verify\r\n      return; // Exit the effect\r\n    }\r\n\r\n    // Ensure a token exists before attempting to verify payment with the backend\r\n    if (!token) {\r\n        console.log('OrderConfirmationPage: No token found, redirecting to login.');\r\n      showCustomModal('You must be logged in to confirm your order.', () => {\r\n        navigate('/login'); // Redirect to login if not authenticated\r\n      });\r\n      setLoading(false);\r\n      return; // Exit function if no token\r\n    }\r\n\r\n    // Set the flag to true to prevent future re-runs of this effect for verification\r\n    hasVerifiedPaymentRef.current = true;\r\n    setLoading(true); // Explicitly set loading to true when starting verification\r\n    setError(null); // Clear any previous errors\r\n\r\n    // Function to send the verification request to your backend\r\n    const verifyPayment = async () => {\r\n      console.log('OrderConfirmationPage: Initiating payment verification for reference:', reference);\r\n      try {\r\n        // Send a POST request to your backend's Paystack verification endpoint\r\n        const response = await fetch('https://jora-mall-backend.onrender.com/api/paystack/verify', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`, // Authenticate the request with user's JWT token\r\n          },\r\n          body: JSON.stringify({ reference }), // Send the Paystack transaction reference\r\n        });\r\n\r\n        // Check if the backend response was successful\r\n        if (!response.ok) {\r\n          const errorData = await response.json();\r\n          throw new Error(errorData.message || 'Payment verification failed on server.');\r\n        }\r\n\r\n        const data = await response.json(); // Parse the successful response\r\n        console.log('OrderConfirmationPage: Payment verification successful, response data:', data);\r\n\r\n        // Check if the backend confirmed the order status\r\n        if (data.order && data.order.status === 'completed' && data.order.paymentStatus === 'paid') {\r\n          setOrder(data.order); // Set the confirmed order details in state\r\n          clearCart(); // Clear the user's cart in the frontend context\r\n          // Use auto-dismiss modal for success confirmation\r\n          showCustomModal('Your order has been successfully placed!', () => {\r\n            // Optional: navigate to order history after acknowledging confirmation\r\n            // navigate('/my-orders');\r\n          }, 3000); // Auto-dismiss after 3 seconds\r\n        } else {\r\n          // If verification succeeded but order status is not as expected\r\n          throw new Error(data.message || 'Order status not confirmed as completed. Please check your order history.');\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error('OrderConfirmationPage: Error during payment verification:', err);\r\n        setError(err.message); // Set error state\r\n        // For errors, it's better to keep the modal with an OK button for user acknowledgement\r\n        showCustomModal(`Order confirmation failed: ${err.message}`, () => {\r\n          navigate('/my-orders'); // Redirect to order history to allow user to check manually\r\n        });\r\n      } finally {\r\n        setLoading(false); // Ensure loading state is turned off after fetch\r\n      }\r\n    };\r\n\r\n    // Only trigger verification if all conditions are met\r\n    verifyPayment();\r\n\r\n  }, [location.search, token, navigate, clearCart, showCustomModal]); // Dependencies for this effect\r\n\r\n  // Render different UIs based on loading, error, or success states\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\">\r\n        <div className=\"bg-white text-gray-800 p-8 rounded-xl shadow-lg text-center\">\r\n          <p className=\"text-2xl font-semibold mb-4\">Verifying your payment and confirming order...</p>\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500 mx-auto mt-4\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\">\r\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative m-4 text-center\">\r\n          <p className=\"font-bold\">Error:</p>\r\n          <p className=\"block sm:inline ml-2\">{error}</p>\r\n          <p className=\"mt-4\">Please check your <Link to=\"/my-orders\" className=\"text-blue-800 hover:underline\">Order History</Link> for updates or contact support.</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If verification completed but no order data is set (e.g., failed silently or redirect issue)\r\n  if (!order) {\r\n    // This case should ideally be caught by error handling or `!reference` check.\r\n    // If it still happens, it indicates an unexpected state.\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#000080] p-4 text-white\">\r\n        <div className=\"bg-white text-gray-800 p-8 rounded-xl shadow-lg text-center\">\r\n          <p className=\"text-2xl font-semibold mb-4\">No order details found.</p>\r\n          <p className=\"text-lg mb-6\">Something went wrong or your order was not successfully processed.</p>\r\n          <Link to=\"/\" className=\"bg-blue-500 text-white py-3 px-8 rounded-lg font-medium hover:bg-blue-600 transition-colors duration-300 shadow-md\">\r\n            Go to Home\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render the confirmed order details\r\n  return (\r\n    <div className=\"min-h-screen bg-[#000080] p-4 sm:p-8 text-white\">\r\n      <header className=\"text-center py-8 bg-gradient-to-r from-blue-800 to-indigo-900 rounded-b-xl shadow-lg mb-8\">\r\n        <h1 className=\"text-4xl font-bold text-white tracking-tight\">Order Confirmed!</h1>\r\n        <p className=\"text-xl text-blue-200 mt-2\">Thank you for your purchase.</p>\r\n      </header>\r\n\r\n      <main className=\"container mx-auto px-4\">\r\n        <div className=\"bg-white rounded-xl shadow-lg p-6 md:p-8 text-gray-800\">\r\n          <h2 className=\"text-2xl font-bold mb-6 text-center text-green-700\">Order #{order._id}</h2>\r\n\r\n          <div className=\"mb-6\">\r\n            <h3 className=\"text-xl font-semibold mb-3\">Order Details</h3>\r\n            <div className=\"space-y-2\">\r\n              <p><strong>Status:</strong> <span className=\"text-green-600 font-medium capitalize\">{order.status}</span></p>\r\n              <p><strong>Total Amount:</strong> <span className=\"font-bold text-blue-700\">{formatPrice(order.totalAmount)}</span></p>\r\n              <p><strong>Payment Status:</strong> <span className=\"capitalize\">{order.paymentStatus}</span></p>\r\n              <p><strong>Order Date:</strong> {new Date(order.createdAt).toLocaleString()}</p>\r\n              {order.paystackReference && <p><strong>Paystack Ref:</strong> {order.paystackReference}</p>}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mb-6\">\r\n            <h3 className=\"text-xl font-semibold mb-3\">Items Ordered</h3>\r\n            <div className=\"space-y-3\">\r\n              {order.items.map(item => (\r\n                <div key={item.product} className=\"flex justify-between items-center border-b border-gray-100 pb-2\">\r\n                  <span className=\"text-gray-700\">{item.name} (x{item.quantity})</span>\r\n                  <span className=\"font-medium text-gray-900\">{formatPrice(item.price * item.quantity)}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mb-6\">\r\n            <h3 className=\"text-xl font-semibold mb-3\">Shipping Address</h3>\r\n            <div className=\"bg-gray-50 p-4 rounded-md space-y-1\">\r\n              <p>{order.shippingAddress.fullName}</p>\r\n              <p>{order.shippingAddress.address}</p>\r\n              <p>{order.shippingAddress.city}, {order.shippingAddress.postalCode}</p>\r\n              <p>{order.shippingAddress.country}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"text-center mt-8 space-y-4\">\r\n            <Link to=\"/my-orders\" className=\"bg-purple-600 text-white py-3 px-8 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-300 shadow-md block max-w-xs mx-auto\">\r\n              View My Orders\r\n            </Link>\r\n            <Link to=\"/\" className=\"text-blue-600 hover:underline block max-w-xs mx-auto\">\r\n              Continue Shopping\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </main>\r\n\r\n      <footer className=\"text-center py-6 mt-8 text-blue-200 text-sm\">\r\n        <p>&copy; {new Date().getFullYear()} Jora Mall. All rights reserved.</p>\r\n      </footer>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OrderConfirmationPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}